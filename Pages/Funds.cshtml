@page
@model BetfairReplicator.Pages.FundsModel
@{
    ViewData["Title"] = "Saldo";
}

<h1>Saldo</h1>

<form method="get" class="mb-3">
    <div class="row g-2 align-items-end">
        <div class="col-8 col-md-3">
            <label class="form-label">Stake %</label>
            <input class="form-control" type="number" name="pct" step="0.1" min="0.1" max="100"
                   value="@Model.StakePercent.ToString("0.0")" />
        </div>
        <div class="col-4 col-md-auto">
            <button class="btn btn-primary w-100" type="submit">Aggiorna</button>
        </div>
    </div>
</form>

<p class="text-muted">Mostra i fondi disponibili per gli account collegati.</p>

<!-- ===== MOBILE: card layout ===== -->
<div class="d-md-none">
    <div class="row g-2">
        @foreach (var r in Model.Rows)
        {
            <div class="col-12 col-sm-6">
                <div class="card bf-mobile-card">
                    <div class="card-body bf-card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="fw-bold">@r.DisplayName</div>

                            @if (!string.IsNullOrWhiteSpace(r.Error))
                            {
                                <span class="badge bg-warning text-dark">ATTENZIONE</span>
                            }
                            else
                            {
                                <span class="badge bg-success">OK</span>
                            }
                        </div>

                        <div class="mt-3 bf-kv">
                            <div class="bf-kv-row">
                                <div class="bf-k">Disponibile</div>
                                <div class="bf-v">@(r.AvailableToBetBalance?.ToString("0.00") ?? "-")</div>
                            </div>
                            <div class="bf-kv-row">
                                <div class="bf-k">Stake (preview)</div>
                                <div class="bf-v">@(r.StakePreview?.ToString("0.00") ?? "-")</div>
                            </div>
                            <div class="bf-kv-row">
                                <div class="bf-k">Esposizione</div>
                                <div class="bf-v">@(r.Exposure?.ToString("0.00") ?? "-")</div>
                            </div>
                        </div>

                        @if (!string.IsNullOrWhiteSpace(r.Error))
                        {
                            <div class="mt-3">
                                <div class="small text-warning fw-semibold">
                                    @r.Error
                                </div>

                                @if (r.Error.Contains("ricollega", StringComparison.OrdinalIgnoreCase))
                                {
                                    <div class="mt-2">
                                        <a class="btn btn-sm btn-primary w-100" asp-page="/ConnectBetfair">Vai a Collega</a>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<!-- ===== DESKTOP/TABLET: tabella classica ===== -->
<div class="d-none d-md-block">
    <table class="table align-middle">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Disponibile</th>
                <th>Stake (preview)</th>
                <th>Esposizione</th>
                <th>Stato</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var r in Model.Rows)
            {
                <tr>
                    <td class="fw-semibold">@r.DisplayName</td>
                    <td>@(r.AvailableToBetBalance?.ToString("0.00") ?? "-")</td>
                    <td>@(r.StakePreview?.ToString("0.00") ?? "-")</td>
                    <td>@(r.Exposure?.ToString("0.00") ?? "-")</td>

                    <td>
                        @if (!string.IsNullOrWhiteSpace(r.Error))
                        {
                            <span class="badge bg-warning text-dark">@r.Error</span>

                            @if (r.Error.Contains("ricollega", StringComparison.OrdinalIgnoreCase))
                            {
                                <div class="mt-2">
                                    <a class="btn btn-sm btn-primary" asp-page="/ConnectBetfair">Vai a Collega</a>
                                </div>
                            }
                        }
                        else
                        {
                            <span class="badge bg-success">OK</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<a class="btn btn-secondary" asp-page="/ConnectBetfair">Indietro</a>
